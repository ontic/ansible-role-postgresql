# Copyright (c) Ontic. (http://www.ontic.com.au). All rights reserved.
# See the COPYING file bundled with this package for license details.

---

- name: 'PostgreSQL | Check if PostgreSQL global config file exists.'
  become: yes
  stat:
    path: '{{ postgresql_global_config_file }}'
  register: 'postgresql_check_global_config_file'

- name: 'PostgreSQL | Replace the global config file.'
  become: yes
  template:
    src: '{{ postgresql_global_config_template }}'
    dest: '{{ postgresql_global_config_file }}'
    force: '{{ postgresql_check_global_config_file.stat.exists == false or postgresql_global_config_file_refresh | bool }}'
    owner: '{{ postgresql_user }}'
    group: '{{ postgresql_group }}'
    mode: '0644'
  notify: 'restart postgresql'
  when: 'postgresql_global_config_template | default(None) != None'

- name: 'PostgreSQL | Configure properties in global config file.'
  become: yes
  ini_file:
    dest: '{{ postgresql_global_config_file }}'
    section:
    option: '{{ item.option | default(omit) }}'
    value: '{{ item.value | default(omit) }}'
    state: '{{ item.state | default(omit) }}'
    owner: '{{ postgresql_user }}'
    group: '{{ postgresql_group }}'
    mode: '0644'
  notify: 'restart postgresql'
  with_items: '{{ postgresql_global_config }}'
  when: 'postgresql_global_config | default(None) != None'